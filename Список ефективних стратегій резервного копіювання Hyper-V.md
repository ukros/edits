Список ефективних стратегій резервного копіювання Hyper-V

Загальні стратегії резервного копіювання Hyper-V

Резервне копіювання віртуальних машин Hyper-V може бути простим, однак, в залежності від налаштувань, воно може бути і складним.

Існує кілька поширених сценаріїв аварійного відновлення для Hyper-V:

    Створюйте резервні копії віртуальних машин та зберігайте історію резервних копій. Наприклад, створюйте резервні копії щовечора і зберігайте останні 7 днів
    
    Резервне копіювання в режимі реального часу та автономне копіювання (гаряче або холодне), відоме як безагентне резервне копіювання.
    
    Зберігаються резервні копії держави (freeze backups)
    
    Резервне копіювання всередині ВМ (резервне копіювання агента)
    
    Реплікація гіпер-V ВМ в реальному часі

 
Резервні копії, зроблені приймаючою стороною

Резервне копіювання Hyper-V в реальному часі

Резервні копії в реальному часі - це те, що потрібно більшості користувачів. Резервне копіювання в реальному часі забезпечується Hyper-V та VSS, службою тіні тома Microsoft Windows XP і новіших версій.

Старіші операційні системи не підтримують VSS і тому не сумісні з інструментами резервного копіювання в реальному часі.

Для правильної роботи резервних копій в реальному часі необхідно мати наступне:

    Операційна система хоста з підтримкою VSS та належним чином функціонуюча VSS. (Windows Server 2008 і вище)
    
    Гостьова операційна система з підтримкою VSS. Віртуальні машини повинні працювати під управлінням Windows XP або Server 2003 і вище. Залежно від версії операційної системи, можуть підтримуватися деякі варіанти Linux.
    
    На кожній віртуальній машині повинні бути встановлені найновіші служби інтеграції Hyper-V Integration Services.
    
    Ви повинні використовувати файлові системи NTFS
    
    Ви повинні мати достатню кількість оперативної пам'яті та дискового простору (не менше 10 ГБ дискового простору та 1 ГБ оперативної пам'яті).
    
    Ви повинні мати достатньо велику площу для зберігання ВСС. Використовуйте VSSUIRUN.EXE або vssadmin для встановлення необмежених або високих лімітів понад 10 ГБ, щоб уникнути проблем.

Програма резервного копіювання ініціює процес і залучає Windows, Hyper-V та VSS. Резервний сигнал також подається на ВМ. Потім запускається VSS ВМ і сповіщає всі служби у ВМ, які можуть обробляти запити VSS. Потім резервна копія приймається на практично заморожений, стійкий до збоїв і збоїв стан ВМ, в той час як ВМ продовжує працювати без перерви.

 
Офлайн резервні копії ВМ

Офлайн резервні копії ВМ відмінно підходять, якщо у вас немає служб або операційних систем з підтримкою VSS. Але також і тому, що офлайн резервні копії іноді бувають "кращими". Для відключення необхідні всі служби, включаючи операційну систему ВМ. Потім робиться резервна копія і ВМ завантажується знову. Це гарантує, що ВМ завантажується через регулярні проміжки часу; однак, необхідний час простою може бути проблемою в багатьох налаштуваннях.

Перезавантаження ВМ корисна тим, що вона очищає Windows і інші тимчасові області в системі і гарантує, що ВМ дійсно завантажується. Іноді VHD можуть бути пошкоджені, або вірус чи помилка програмного забезпечення можуть викликати проблеми з процесом завантаження. Якщо резервні копії завжди живі і ВМ ніколи не перезавантажується, помилки ніколи не з'являться і залишаться непоміченими.

Крім того, адміністратор часто не знає, чи запущені на віртуальному сервері несумісні з VSS служби.

Прикладами цього є:

    Microsoft Access
    
    MySQL
    
    Власні бази даних та плоскі файлові сховища даних

 
Збережені державні резервні копії

Saved State - це те, що Microsoft винайшла, щоб мати можливість створювати досить корисні резервні копії з (зазвичай) мінімальною втратою даних з операційних систем, не сумісних з VSS:

    Більшість варіантів Linux на серверах Windows Server 2008/R2 та 2012.
    
    Windows Server 2000 і старше
    
    Сучасні версії Windows зі старими або неіснуючими службами інтеграції Hyper-V
    

Якщо на ВМ не встановлена поточна версія Hyper-V Integration Service, резервне копіювання буде виконано в режимі збереженого стану (Saved State).

Резервне копіювання також може виконуватися в режимі збереженого стану (рішення приймається керівництвом Hyper-V, а не програмою резервного копіювання), якщо:

    Недостатньо доступних ресурсів (оперативної пам'яті, як у випадку з сильно фрагментованою оперативною пам'яттю).
    
    ОС ВМ знаходиться в процесі завантаження або завершення роботи

 
Реплікація ВМ Hyper-V в реальному часі

Ви можете реплікувати віртуальні машини з одного сервера на інший, а також підтримувати X кількість минулих версій за допомогою резервного копіювання версій. Замість того, щоб стискати і дедуплікувати віртуальні диски, їх можна скопіювати після того, як VSS приведе їх до стану, стійкого до збоїв і сумісного з додатками. На сервері відновлення вони можуть бути завантажені в будь-який момент без затримок, оскільки віртуальні диски зберігаються у своєму рідному форматі і готові до завантаження.

 
Резервне копіювання, що виконується всередині ВМ (агентське резервне копіювання)



Деякі сценарії вимагають створення резервних копій у віртуальній машині:

    Ви використовуєте несумісну з VSS операційну систему, резервну копію якої неможливо створити в реальному часі з хоста, наприклад, Linux або Windows Server 2000.
    
    Ви використовуєте безпосередньо підключене сховище у віртуальній машині, наприклад, iSCSI або змонтований розділ, фізично розташований на хості.

 
Ще одне рішення для того, щоб обидві стратегії працювали

[Використовуйте це програмне забезпечення для резервного копіювання Hyper-V для реалізації вищезазначених стратегій.](https://backupchain.com/en/hyper-v-backup/). також, [Зі стратегією можна ознайомитися тут](https://doctorpapadopoulos.com/in-depth-whats-the-best-backup-scheme-and-strategy/)

Granular Backup for Hyper-V - це інноваційна функція, яка дозволяє ІТ-адміністраторам отримувати доступ до файлів у віртуальних машинах з хоста. Вони можуть виконувати резервне копіювання папок віртуальних машин без встановлення програмного забезпечення всередині віртуальних машин, коли віртуальні диски віртуальних машин доступні з хоста. Дивіться це рішення для резервного копіювання для Hyper-V і це.
